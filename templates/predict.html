{% extends "base.html" %}

{% block title %}Predict - Sleep Disorder FHE{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <!-- Header -->
        <div class="text-center mb-4">
            <h1 class="display-5">
                <i class="bi bi-moon-stars text-primary"></i> Sleep Disorder Prediction
            </h1>
            <p class="lead text-muted">
                Enter your health and lifestyle metrics for a privacy-preserving prediction
            </p>
        </div>

       

        <!-- Prediction Form -->
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-clipboard-data"></i> Enter Your Health Metrics
                </h5>
            </div>
            <div class="card-body">
                <form id="predictionForm">
                    <div class="row">
                        <!-- Gender -->
                        <div class="col-md-6 mb-3">
                            <label for="Gender" class="form-label">
                                Gender
                                <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" title="Biological sex"></i>
                            </label>
                            <select class="form-select" id="Gender" name="Gender" required>
                                <option value="">Select...</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>

                        <!-- Age -->
                        <div class="col-md-6 mb-3">
                            <label for="Age" class="form-label">
                                Age
                                <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" title="Age in years"></i>
                            </label>
                            <input 
                                type="number" 
                                class="form-control" 
                                id="Age" 
                                name="Age" 
                                min="18" 
                                max="100" 
                                required
                                placeholder="e.g., 35"
                            >
                        </div>

                        <!-- Sleep Duration -->
                        <div class="col-md-6 mb-3">
                            <label for="Sleep Duration" class="form-label">
                                Sleep Duration (hours)
                                <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" title="Average hours of sleep per night"></i>
                            </label>
                            <input 
                                type="number" 
                                class="form-control" 
                                id="Sleep Duration" 
                                name="Sleep Duration" 
                                step="0.1" 
                                min="0" 
                                max="24" 
                                required
                                placeholder="e.g., 7.5"
                            >
                        </div>

                        <!-- Quality of Sleep -->
                        <div class="col-md-6 mb-3">
                            <label for="Quality of Sleep" class="form-label">
                                Quality of Sleep (1-10)
                                <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" title="Self-rated sleep quality"></i>
                            </label>
                            <input 
                                type="number" 
                                class="form-control" 
                                id="Quality of Sleep" 
                                name="Quality of Sleep" 
                                min="1" 
                                max="10" 
                                required
                                placeholder="e.g., 7"
                            >
                        </div>

                        <!-- Physical Activity Level -->
                        <div class="col-md-6 mb-3">
                            <label for="Physical Activity Level" class="form-label">
                                Physical Activity Level (min/day)
                                <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" title="Minutes of physical activity per day"></i>
                            </label>
                            <input 
                                type="number" 
                                class="form-control" 
                                id="Physical Activity Level" 
                                name="Physical Activity Level" 
                                min="0" 
                                max="300" 
                                required
                                placeholder="e.g., 60"
                            >
                        </div>

                        <!-- Stress Level -->
                        <div class="col-md-6 mb-3">
                            <label for="Stress Level" class="form-label">
                                Stress Level (1-10)
                                <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" title="Self-rated stress level"></i>
                            </label>
                            <input 
                                type="number" 
                                class="form-control" 
                                id="Stress Level" 
                                name="Stress Level" 
                                min="1" 
                                max="10" 
                                required
                                placeholder="e.g., 6"
                            >
                        </div>

                        <!-- BMI Category -->
                        <div class="col-md-6 mb-3">
                            <label for="BMI Category" class="form-label">
                                BMI Category
                                <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" title="Body Mass Index category"></i>
                            </label>
                            <select class="form-select" id="BMI Category" name="BMI Category" required>
                                <option value="">Select...</option>
                                <option value="Normal">Normal</option>
                                <option value="Normal Weight">Normal Weight</option>
                                <option value="Overweight">Overweight</option>
                                <option value="Obese">Obese</option>
                            </select>
                        </div>

                        <!-- Blood Pressure -->
                        <div class="col-md-6 mb-3">
                            <label for="Blood Pressure" class="form-label">
                                Blood Pressure (Systolic/Diastolic)
                                <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" title="e.g., 120/80"></i>
                            </label>
                            <input 
                                type="text" 
                                class="form-control" 
                                id="Blood Pressure" 
                                name="Blood Pressure" 
                                pattern="\d{2,3}/\d{2,3}" 
                                required
                                placeholder="e.g., 120/80"
                            >
                        </div>

                        <!-- Heart Rate -->
                        <div class="col-md-6 mb-3">
                            <label for="Heart Rate" class="form-label">
                                Heart Rate (bpm)
                                <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" title="Beats per minute"></i>
                            </label>
                            <input 
                                type="number" 
                                class="form-control" 
                                id="Heart Rate" 
                                name="Heart Rate" 
                                min="40" 
                                max="200" 
                                required
                                placeholder="e.g., 72"
                            >
                        </div>

                        <!-- Daily Steps -->
                        <div class="col-md-6 mb-3">
                            <label for="Daily Steps" class="form-label">
                                Daily Steps
                                <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" title="Average steps per day"></i>
                            </label>
                            <input 
                                type="number" 
                                class="form-control" 
                                id="Daily Steps" 
                                name="Daily Steps" 
                                min="0" 
                                max="50000" 
                                required
                                placeholder="e.g., 8000"
                            >
                        </div>
                    </div>

                    <!-- Comparison Mode Toggle -->
                    <div class="mt-3 p-3 bg-light rounded">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="compareMode">
                            <label class="form-check-label" for="compareMode">
                                <strong>ðŸ“Š Compare Plaintext vs FHE</strong>
                                <br>
                                <small class="text-muted">
                                    Run both methods and compare performance & privacy (takes longer)
                                </small>
                            </label>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-between mt-4">
                        <button type="button" class="btn btn-outline-secondary" onclick="fillSampleData()">
                            <i class="bi bi-arrow-clockwise"></i> Fill Sample Data
                        </button>
                        <div class="d-grid gap-2 d-md-flex">
                            <button type="reset" class="btn btn-outline-danger">
                                <i class="bi bi-x-circle"></i> Clear
                            </button>
                            <button type="submit" class="btn btn-primary" id="predictBtn">
                                <i class="bi bi-cpu"></i> Predict
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Results Card -->
        <div id="resultsCard" class="card shadow mt-4" style="display: none;">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="bi bi-check-circle"></i> Prediction Results
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h4 id="predictionResult" class="text-primary mb-3"></h4>
                        <p id="predictionInterpretation" class="text-muted"></p>
                        <div id="modeIndicator" class="mt-3 mb-3"></div>
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="bi bi-clock"></i> Prediction time: <span id="latency"></span>ms
                            </small>
                        </div>
                    </div>
                    <div class="col-md-4 text-center">
                        <div id="predictionIcon" class="display-1 mb-2"></div>
                        <div id="predictionLabel" class="fw-bold"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Comparison Card -->
        <div id="comparisonCard" class="card shadow mt-4" style="display: none;">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="bi bi-bar-chart"></i> Plaintext vs FHE Comparison
                </h5>
            </div>
            <div class="card-body" id="comparisonBody">
                <!-- Comparison results will be inserted here -->
            </div>
        </div>

        <!-- Error Alert -->
        <div id="errorAlert" class="alert alert-danger alert-dismissible fade show mt-4" role="alert" style="display: none;">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <strong>Error:</strong> <span id="errorMessage"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/fhe_client.js') }}"></script>
<script src="{{ url_for('static', filename='js/predict_comparison.js') }}"></script>
{% endblock %}
